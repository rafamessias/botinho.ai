class t{constructor(t={}){this.survey=t.surveyData,this.onComplete=t.onComplete||(()=>{}),this.onClose=t.onClose||(()=>{}),this.container=null,this.i=0,this.done=!1,this.r={},this.ot={}}mount(t){this.container=document.getElementById(t),this.container&&this.survey&&(this.injectCSS(),this.render(),this.container.addEventListener("click",t=>this.onClick(t)),this.container.addEventListener("input",t=>this.onInput(t)))}injectCSS(){if(this.t)return
const t=document.createElement("style")
t.textContent=".sv{min-width:300px;min-height:300px;font:inherit;color:inherit}.card{position:relative;display:flex;flex-direction:column;justify-content:space-between;background:transparent;color:inherit;border:1px solid currentColor;border-radius:6px;margin:16px 0;padding:16px;max-width:300px;min-height:300px;box-shadow:0 8px 12px rgba(0,0,0,.08)}.x{position:absolute;top:4px;right:4px;width:32px;height:32px;border:0;border-radius:50%;background:transparent;opacity:.7;cursor:pointer;font-size:24px}.x:hover{opacity:1}.body{padding:.5rem;margin-bottom:1rem;overflow:hidden;transition:opacity .3s ease}.qc{width:100%;height:100%;padding:0 4px}.qt{font-weight:600;margin-bottom:.5rem;font-size:18px}.qd{opacity:.8;margin-bottom:1rem;font-size:16px}.qs{margin-bottom:1rem;font-size:20px}.opts{margin-top:1.8rem;display:flex;flex-direction:column;align-items:flex-start}.req{color:#ef4444;font-size:1.2rem}.ft{padding:.5rem;display:flex;flex-direction:column}.nav{display:flex}.btn{display:flex;align-items:center;gap:.5rem;padding:.5rem 1rem;border-radius:6px;cursor:pointer;font:inherit}.btno{margin-right:.5rem;background:currentColor;opacity:.7}.btno:hover{opacity:.5}.btnp{border:0;background:currentColor}.btnp:hover{opacity:.9}.brand{margin-top:1rem;font-size:.75rem;opacity:.7}.rad,.chk{display:flex;align-items:center;gap:.5rem;margin-bottom:.5rem;cursor:pointer}.txt{width:100%;padding:.5rem;border:1px solid currentColor;border-radius:6px;font-size:16px;background:transparent;box-sizing:border-box}.stars{display:flex;gap:.25rem;justify-content:center}.star{border:0;background:none;cursor:pointer;font-size:40px;line-height:1}.ltxt{width:100%}.ta{width:100%;min-height:6rem;resize:none;border:1px solid currentColor;border-radius:6px;padding:.5rem;font-size:16px;background:transparent;box-sizing:border-box}.ok{display:flex;align-items:center;justify-content:center;height:195px;font-size:90px;opacity:0;animation:a .6s ease-out .2s forwards}.ok span{width:100px;height:100px;display:flex;align-items:center;justify-content:center;border-radius:100px;background:#10b981;color:#fff;font-size:60px}@keyframes p{0%,100%{transform:translateX(0)}25%{transform:translateX(-4px)}75%{transform:translateX(4px)}}@keyframes a{0%{opacity:0;transform:scale(.3)}50%{transform:scale(1.1)}100%{opacity:1;transform:scale(1)}}@media(max-width:400px){.card{max-width:100%;margin:8px;padding:16px}.qt{font-size:16px}.star{font-size:20px}}",document.head.appendChild(t),this.t=1}render(){if(!this.container)return
const t=this.survey.questions,s=this.i>=t.length
this.container.innerHTML='<div class="sv"><div class="card"><button class="x" data-a="close">×</button>'+(this.done||s?this.renderDone():this.renderQuestionCard(t[this.i]))+'<div class="ft">'+(this.done?"":'<div class="nav">'+(this.i>0?'<button class="btn btno" data-a="prev">≺</button>':"")+'<button class="btn btnp" data-a="next">'+(this.i===t.length-1?"⋗":"≻")+"</button></div>")+'<div class="brand">Powered by <a href="https://opineeo.com" target="_blank"><b>Opineeo</b></a></div></div></div></div>',this.focusInput()}renderQuestionCard(t){return'<div class="body"><div class="qc"><h2 class="qt">'+t.title+(t.required?' <span class="req">*</span>':"")+"</h2>"+(t.description&&"STATEMENT"!==t.format?'<p class="qd">'+t.description+"</p>":"")+'<div class="opts">'+this.renderQuestion(t)+"</div></div></div>"}resp(t,s,i,e){const a={questionId:t,isOther:e}
return"string"==typeof s?a.textValue=s:"number"==typeof s?a.numberValue=s:"boolean"==typeof s&&(a.booleanValue=s),null!=i&&(a.optionId=i),a}renderQuestion(t){const s=this.r[t.id]
if("YES_NO"===t.format){const i=!0===s?.booleanValue?"yes":!1===s?.booleanValue?"no":null
return this.radioList(t.id,[{id:"yes",text:t.yesLabel||"Yes"},{id:"no",text:t.noLabel||"No"}],i)}if("SINGLE_CHOICE"===t.format){const i=s?.optionId
return t.options.map(s=>{const e=i===s.id
return'<label class="rad"><input type="radio" name="q_'+t.id+'" value="'+s.id+'" '+(e?"checked":"")+' data-a="set" data-q="'+t.id+'"><span>'+s.text+"</span></label>"+(s.isOther?'<div class="other" '+(e?"":"hidden")+'><input class="txt" type="text" placeholder="Please specify…" value="'+(this.ot[t.id]||"")+'" data-a="other" data-q="'+t.id+'"></div>':"")}).join("")}if("MULTIPLE_CHOICE"===t.format){const i=s?.optionId?s.optionId.split(","):[],e=i.some(s=>t.options.find(t=>t.id===s)?.isOther)
return t.options.map(s=>{const a=i.includes(s.id)
return'<label class="chk"><input type="checkbox" value="'+s.id+'" '+(a?"checked":"")+' data-a="toggle" data-q="'+t.id+'"><span>'+s.text+"</span></label>"+(s.isOther?'<div class="other" '+(e?"":"hidden")+'><input class="txt" type="text" placeholder="Please specify…" value="'+(this.ot[t.id]||"")+'" data-a="other" data-q="'+t.id+'"></div>':"")}).join("")}if("STAR_RATING"===t.format){const i=s?.numberValue||0
return'<div class="stars" data-q="'+t.id+'" data-a="stars">'+[1,2,3,4,5].map(t=>'<button class="star" data-star="'+t+'" aria-label="'+t+' star">'+(t>i?"☆":"★")+"</button>").join("")+"</div>"}return"LONG_TEXT"===t.format?'<div class="ltxt"><textarea class="ta" data-a="setText" data-q="'+t.id+'">'+(s?.textValue||"")+"</textarea></div>":"STATEMENT"===t.format?'<p class="qs">'+(t.description||"")+"</p>":'<p class="qd">Unsupported question type</p>'}radioList(t,s,i){return s.map(s=>'<label class="rad"><input type="radio" name="q_'+t+'" value="'+s.id+'" '+(i===s.id?"checked":"")+' data-a="set" data-q="'+t+'"><span>'+s.text+"</span></label>").join("")}renderDone(){return this.o||(this.o=1,this.onComplete(this.pack()),setTimeout(()=>this.onClose(),2500)),'<div class="ok"><span>✓</span></div>'}onClick(t){const s=t.target,i=s.dataset.a||s.closest("[data-a]")?.dataset.a
if(i)if("close"!==i){if("prev"===i)return this.i--,void this.render()
if("next"===i){const t=this.survey.questions[this.i]
return t.required&&!this.r[t.id]?void this.shake():(this.i++,this.i<this.survey.questions.length||(this.done=!0),void this.render())}if("set"===i){const t=s.dataset.q||s.closest("[data-q]")?.dataset.q,i=this.survey.questions.find(s=>s.id===t),e=i?.options?.find(t=>t.id===s.value)
return"YES_NO"===i?.format?this.r[t]=this.resp(t,"yes"===s.value,void 0,!1):(this.r[t]=this.resp(t,void 0,s.value,!!e?.isOther),e?.isOther||delete this.ot[t]),void this.render()}if("toggle"===i){const t=s.dataset.q||s.closest("[data-q]")?.dataset.q,i=this.survey.questions.find(s=>s.id===t),e=i?.options?.find(t=>t.id===s.value),a=this.r[t]?.optionId?this.r[t].optionId.split(","):[],r=a.indexOf(s.value)
r>-1?(a.splice(r,1),e?.isOther&&delete this.ot[t]):a.push(s.value)
const n=a.some(t=>i?.options?.find(s=>s.id===t)?.isOther)
return this.r[t]=this.resp(t,void 0,a.join(","),n),void this.render()}if("stars"===i){const t=s.closest(".star")
if(!t)return
const i=s.closest("[data-q]").dataset.q
return this.r[i]=this.resp(i,+t.dataset.star,void 0,!1),void this.render()}}else this.close()}onInput(t){const s=t.target,i=s.dataset.a
if("other"===i){const t=s.dataset.q
this.ot[t]=s.value}if("setText"===i){const t=s.dataset.q
this.r[t]=this.resp(t,s.value,void 0,!1)}}shake(){const t=this.container.querySelector(".qc")
t&&(t.style.animation="p .25s ease",setTimeout(()=>t.style.animation="",250))}focusInput(){const t=this.survey.questions[this.i]
setTimeout(()=>{"LONG_TEXT"===t?.format?this.container.querySelector(".ta")?.focus():this.container.querySelector(".other:not([hidden]) .txt")?.focus()},30)}close(){this.container&&(this.container.style.display="none"),this.onClose()}pack(){return Object.keys(this.r).map(t=>{const s=this.r[t]
return s.isOther&&this.ot[t]?{...s,textValue:this.ot[t]}:s})}}window.initSurveyWidgetMinimalV2=s=>new t(s)
